"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatTime=exports.formatNumber=exports.generateMD5=exports.formatSourceMap=exports.isFileIgnored=exports.leading=exports.trailing=exports.escapeQuot=exports.mkdirSync=exports.rmSync=exports.isHexColor=exports.formatJSONParseErr=exports.bufferToUtf8String=exports.getType=exports.normalizePath=void 0;const fs=require("fs"),path=require("path"),babelCodeFrame=require("babel-code-frame"),minimatch=require("minimatch"),crypto=require("crypto"),jsonParse=require("./jsonlint.js").parser;function normalizePath(e=""){const t=path.posix.normalize(e.replace(/\\/g,"/"));return!e.startsWith("//")&&!e.startsWith("\\\\")||t.startsWith("//")?t:"/"+t}function getType(e){return Object.prototype.toString.call(e).toLowerCase().split(" ")[1].replace("]","")}exports.normalizePath=normalizePath,exports.getType=getType;const bufferToUtf8String=e=>{const t=e.toString();if(0===Buffer.compare(Buffer.from(t,"utf8"),e))return t};function getErrLine(e,t,r,n){return`${n}\n${babelCodeFrame(e,t,r=r>0?r:1)}`}exports.bufferToUtf8String=bufferToUtf8String;const formatJSONParseErr=e=>{const t=e.data||"";try{jsonParse.parse(t)}catch(r){try{const n=`Expecting ${r.expected}, got ${r.token}`,o=getErrLine(t,r.line,r.loc.first_column,n);return`${e.filePath}\n${o}`}catch(e){}}return`${e.filePath}\n${e.error}`};exports.formatJSONParseErr=formatJSONParseErr;const isHexColor=e=>/^#[a-f\d]{3}$/i.test(e)||/^#[a-f\d]{4}$/i.test(e)||/^#[a-f\d]{6}$/i.test(e)||/^#[a-f\d]{8}$/i.test(e);function rmSync(e){try{if(e=path.resolve(e),!fs.existsSync(e))return;if(fs.lstatSync(e).isDirectory()){const t=fs.readdirSync(e);if(t.length>0)for(let r=0,n=t.length;r<n;r++)rmSync(path.posix.join(e,t[r]));fs.rmdirSync(e)}else fs.unlinkSync(e)}catch(e){}}function mkdirSync(e){if(e=path.resolve(e),fs.existsSync(e)){if(fs.lstatSync(e).isDirectory())return;fs.unlinkSync(e)}mkdirSync(path.dirname(e)),fs.mkdirSync(e)}function escapeQuot(e,t="`"){return e?"`"===t?e.replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$/g,"\\$"):'"'===t?e.replace(/\\/g,"\\\\").replace(/\r\n/g,"\n").replace(/\n/g,"\\n").replace(/"/g,'\\"'):"'"===t?e.replace(/\\/g,"\\\\").replace(/\r\n/g,"\n").replace(/\n/g,"\\n").replace(/'/g,"\\'"):e:e}function trailing(e,t,r=!1){return r?e.endsWith(t)?e.slice(0,e.length-1):e:e.endsWith(t)?e:e+t}function leading(e,t,r=!1){return r?e.startsWith(t)?e.slice(1):e:e.startsWith(t)?e:t+e}exports.isHexColor=isHexColor,exports.rmSync=rmSync,exports.mkdirSync=mkdirSync,exports.escapeQuot=escapeQuot,exports.trailing=trailing,exports.leading=leading;const FFSPRGRulesFactory=function(e){let t=null,r=Object.create(null);return function(e,n){if(n.length<1)return!1;if(t===n){if(void 0!==r[e])return r[e]}else t=n,r=Object.create(null);const o=e.replace(/\\/g,"/").toLowerCase();if(!o)return!1;const i=o.slice(o.lastIndexOf("/")+1);let s=!1;for(const e of n){if(!e)continue;const t=e.value.toLowerCase();if("prefix"===e.type)s=i.startsWith(t);else if("suffix"===e.type)s=i.endsWith(t);else if("folder"===e.type)s=leading(o,"/").startsWith(trailing(leading(t,"/"),"/"));else if("file"===e.type)s=leading(o,"/")===leading(t,"/");else if("glob"===e.type)try{s=minimatch(o,t)||minimatch(leading(o,"/"),t)}catch(e){s=!1}else if("regexp"===e.type)try{s=new RegExp(t,"igm").test(o)||new RegExp(t,"igm").test(leading(o,"/"))}catch(e){s=!1}if(s)break}return r[e]=s,s}};function formatSourceMap(e){if(e){if("string"===getType(e))return e;try{return JSON.stringify(e)}catch(e){}}}function generateMD5(e){const t=crypto.createHash("md5");return t.update(e),t.digest("hex")}exports.isFileIgnored=FFSPRGRulesFactory(),exports.formatSourceMap=formatSourceMap,exports.generateMD5=generateMD5;const formatNumber=e=>e>9?""+e:"0"+e;exports.formatNumber=formatNumber;const formatTime=e=>{const t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),o=e.getHours(),i=e.getMinutes(),s=e.getSeconds();return[t,r,n].map(exports.formatNumber).join("/")+" "+[o,i,s].map(exports.formatNumber).join(":")};exports.formatTime=formatTime;