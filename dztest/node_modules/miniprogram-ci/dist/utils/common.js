"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAllTargetTypeFilesWithOtherTypeFilesOfSameName=exports.checkPath=exports.ECheckPathType=exports.checkUTF8=exports.throwError=exports.getAllPagesInfo=exports.getAllPages=void 0;const tools_1=require("./tools"),config_1=require("../config"),path=require("path"),locales=require("./locales/locales"),getAllPages=e=>{const t=[...e.pages];if(e.subPackages)for(const o of e.subPackages)for(const e of o.pages)t.push(tools_1.normalizePath(path.posix.join(o.root,e)));return t};exports.getAllPages=getAllPages;const getAllPagesInfo=e=>{const t=e.pages.map(e=>({path:e,root:config_1.MINI_PROGRAM_MAIN_PACKAGE_ROOT,name:config_1.MINI_PROGRAM_MAIN_PACKAGE_ROOT}));if(e.subPackages)for(const o of e.subPackages)for(const e of o.pages)t.push({path:tools_1.normalizePath(path.posix.join(o.root,e)),root:o.root,name:o.name||""});return t};function throwError(e){const{msg:t,code:o=config_1.JSON_CONTENT_ERR,filePath:r}=e,s=new Error(`${r}: ${t}`);throw s.code=o,s.path=r,s}function checkUTF8(e,t){let o="";try{o=tools_1.bufferToUtf8String(e)}catch(e){o=""}return void 0===o&&throwError({msg:locales.config.FILE_NOT_UTF8.format(t),code:config_1.FILE_NOT_UTF8,filePath:t}),o}var ECheckPathType;function checkPath(e){const{value:t,tips:o,filePath:r="app.json",code:s=config_1.JSON_CONTENT_ERR,checkPathType:a=e.checkPathType||ECheckPathType.NORMAL}=e;"string"!==tools_1.getType(t)&&throwError({msg:locales.config.JSON_CONTENT_SHOULD_BE.format([o,"string"]),code:s,filePath:r}),""===t&&throwError({msg:locales.config.JSON_CONTENT_SHOULD_NOT_BE.format([o,"''"]),code:s,filePath:r}),t.includes("\\")&&throwError({msg:locales.config.JSON_SHOULD_NOT_CONTAIN.format([o,"\\"]),code:s,filePath:r}),a===ECheckPathType.NORMAL&&t.startsWith(".")&&throwError({msg:locales.config.JSON_SHOULD_NOT_START_WITH.format([o,"."]),code:s,filePath:r}),a===ECheckPathType.NORMAL&&t.startsWith("/")&&throwError({msg:locales.config.JSON_SHOULD_NOT_START_WITH.format([o,"/"]),code:s,filePath:r}),t.startsWith(" ")&&throwError({msg:locales.config.JSON_SHOULD_NOT_START_WITH.format([o," "]),code:s,filePath:r}),(t.includes("../")||t.endsWith("/.."))&&throwError({msg:locales.config.JSON_SHOULD_NOT_CONTAIN.format([o,"../"]),code:s,filePath:r})}function getAllTargetTypeFilesWithOtherTypeFilesOfSameName(e,t,o,r){if(!t)return[];const s=e.getFileList(r,t);if(!o||0===o.length)return s;const a=o.map(t=>new Set(e.getFileList(r,t).map(e=>e.slice(0,-t.length))));return s.map(e=>e.slice(0,-t.length)).filter(e=>a.every(t=>t.has(e))).map(e=>`${e}${t}`)}exports.getAllPagesInfo=getAllPagesInfo,exports.throwError=throwError,exports.checkUTF8=checkUTF8,function(e){e.NORMAL="NORMAL",e.TAB_BAR_ICON="TAB_BAR_ICON"}(ECheckPathType=exports.ECheckPathType||(exports.ECheckPathType={})),exports.checkPath=checkPath,exports.getAllTargetTypeFilesWithOtherTypeFilesOfSameName=getAllTargetTypeFilesWithOtherTypeFilesOfSameName;