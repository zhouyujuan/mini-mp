"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.appendBabelHelpers=exports.getBabelOutputPath=exports.isValidBabelHelperFunc=exports.collectBabelHelpers=exports.replaceBabelHelpers=exports.searchBabelModule=exports.isIgnore=exports.getHelperContent=exports.getHelperDeps=exports.getCustomPlugins=exports.getDefaultPlugins=void 0;const fs=require("fs-extra"),path=require("path"),tools_1=require("./tools"),DepMap={applyDecoratedDescriptor:[],arrayWithHoles:[],arrayWithoutHoles:[],assertThisInitialized:[],AsyncGenerator:["AwaitValue"],asyncGeneratorDelegate:[],asyncIterator:[],asyncToGenerator:[],awaitAsyncGenerator:["AwaitValue"],AwaitValue:[],classCallCheck:[],classNameTDZError:[],classPrivateFieldGet:[],classPrivateFieldLooseBase:[],classPrivateFieldLooseKey:[],classPrivateFieldSet:[],classPrivateMethodGet:[],classPrivateMethodSet:[],classStaticPrivateFieldSpecGet:[],classStaticPrivateFieldSpecSet:[],construct:["setPrototypeOf"],createClass:[],decorate:["typeof","toArray","toPropertyKey"],defaults:[],defineEnumerableProperties:[],defineProperty:[],extends:[],get:["getPrototypeOf","superPropBase"],getPrototypeOf:[],inherits:["setPrototypeOf"],inheritsLoose:[],initializerDefineProperty:[],initializerWarningHelper:[],instanceof:[],interopRequireDefault:[],interopRequireWildcard:[],isNativeFunction:[],iterableToArray:[],iterableToArrayLimit:[],iterableToArrayLimitLoose:[],jsx:[],newArrowCheck:[],nonIterableRest:[],nonIterableSpread:[],objectDestructuringEmpty:[],objectSpread:["defineProperty"],objectWithoutProperties:["objectWithoutPropertiesLoose"],objectWithoutPropertiesLoose:[],possibleConstructorReturn:["typeof","assertThisInitialized"],readOnlyError:[],set:["getPrototypeOf","superPropBase","defineProperty"],setPrototypeOf:[],skipFirstGeneratorNext:[],slicedToArray:["arrayWithHoles","iterableToArrayLimit","nonIterableRest"],slicedToArrayLoose:["arrayWithHoles","iterableToArrayLimitLoose","nonIterableRest"],superPropBase:["getPrototypeOf"],taggedTemplateLiteral:[],taggedTemplateLiteralLoose:[],temporalRef:["temporalUndefined"],temporalUndefined:[],toArray:["arrayWithHoles","iterableToArray","nonIterableRest"],toConsumableArray:["arrayWithoutHoles","iterableToArray","nonIterableSpread"],toPrimitive:["typeof"],toPropertyKey:["typeof","toPrimitive"],typeof:[],wrapAsyncGenerator:["AsyncGenerator"],wrapNativeSuper:["getPrototypeOf","setPrototypeOf","isNativeFunction","construct"],regenerator:[],Objectentries:[],Objectvalues:[],Arrayincludes:[]};function getDefaultPlugins(){const e=require("@babel/plugin-syntax-dynamic-import").default,t=require("@babel/plugin-syntax-import-meta").default,r=require("@babel/plugin-proposal-class-properties").default,o=require("@babel/plugin-proposal-json-strings").default,a=require("@babel/plugin-proposal-decorators").default,l=require("@babel/plugin-proposal-function-sent").default,s=require("@babel/plugin-proposal-export-namespace-from").default,i=require("@babel/plugin-proposal-numeric-separator").default,p=require("@babel/plugin-proposal-throw-expressions").default,n=require("@babel/plugin-proposal-export-default-from").default,u=require("@babel/plugin-proposal-logical-assignment-operators").default,c=require("@babel/plugin-proposal-optional-chaining").default,b=require("@babel/plugin-proposal-pipeline-operator").default,g=require("@babel/plugin-proposal-nullish-coalescing-operator").default,f=require("@babel/plugin-proposal-do-expressions").default,d=require("@babel/plugin-proposal-function-bind").default;return new Map([[d,0],[n,0],[u,0],[c,{loose:!1}],[b,{proposal:"minimal"}],[g,{loose:!1}],[f,0],[a,{legacy:!0}],[l,0],[s,0],[i,0],[p,0],[e,0],[t,0],[r,{loose:!0}],[o,0]])}function getCustomPlugins(e=[]){const t=getDefaultPlugins(),r=[];for(const[e,o]of t)0===o?r.push(e):r.push([e,o]);return r}function getHelperDeps(e,t){const r={};for(;e.length;){const o=e.shift()||"",a=o.substr(0,o.indexOf(t)+t.length),l=o.replace(a+"/helpers/","");l in DepMap&&DepMap[l].map(t=>{const o=`${a}/helpers/${t}`;r[o]||(e.push(o),r[o]=!0)}),r[o]=!0}return r}function getHelperContent(e,t){const r=e.substr(0,e.indexOf(t)+t.length),o=e.replace(r,"babel_runtime"),a=tools_1.normalizePath(path.join(__dirname,"../",o+".js"));return fs.readFile(a,"utf8")}function isIgnore(e,t){const r=e||[],o=t.split(path.sep).join("/");for(const e of r){if(t===e)return!0;if(!/^[\.\/\\]+/.test(e)&&/.+\/\*$/.test(e)&&-1!==o.indexOf(e.substr(0,e.length-1)))return!0}return!1}function searchBabelModule(e,t){const r=[],o=new RegExp('require\\("[\\.\\/]*('+t+'[^"]+)"\\)',"gi");return e.replace(o,(function(e,o){const a=o.replace(t,"").match(/\/(helpers|regenerator)\/?(.+)?/);return(a&&"regenerator"===a[1]||a&&"helpers"===a[1]&&DepMap.hasOwnProperty(a[2]))&&r.push(o),e})),r}function replaceBabelHelpers(e,t={},r,o){const a=new Set,l=r.split("/").map((e,t)=>0===t?"":"../").join("");return{transformCode:e.replace(/require\("(@babel\/runtime\/[^"]+)"\)/gi,(function(e,r){const s=r.replace(/@babel\/runtime\/(helpers\/)?/,"").replace(/\.js$/,""),i=r.replace("@babel/runtime",o),p=DepMap.hasOwnProperty(s);return!t[r]&&p?(a.add(i),`require("${l+i}")`):e})),helpers:Array.from(a)}}function collectBabelHelpers(e){const t={};return e.replace(/require\("(@babel\/runtime\/[^"]+)"\)/gi,(function(e,r){return t[r]=!0,e})),t}function isValidBabelHelperFunc(e){return DepMap.hasOwnProperty(e)}function getBabelOutputPath(e){let t=e.setting.babelSetting?e.setting.babelSetting.outputPath:"";return t?(t=tools_1.normalizePath(t),t.replace(/(^[\.\/\\])|(\/$)/g,""),t):"@babel/runtime"}async function appendBabelHelpers(e,t,r,o){const a=getHelperDeps(Array.from(e),r),l=Object.keys(a).map(async e=>{try{const a=await getHelperContent(e,r),l=tools_1.normalizePath(path.posix.join(t,/\.js$/.test(e)?""+e:e+".js"));o[l]||(o[l]=a)}catch(e){if("EEXIST"===e.code);else if("ENOENT"!==e.code)throw e}});return Promise.all(l)}exports.getDefaultPlugins=getDefaultPlugins,exports.getCustomPlugins=getCustomPlugins,exports.getHelperDeps=getHelperDeps,exports.getHelperContent=getHelperContent,exports.isIgnore=isIgnore,exports.searchBabelModule=searchBabelModule,exports.replaceBabelHelpers=replaceBabelHelpers,exports.collectBabelHelpers=collectBabelHelpers,exports.isValidBabelHelperFunc=isValidBabelHelperFunc,exports.getBabelOutputPath=getBabelOutputPath,exports.appendBabelHelpers=appendBabelHelpers;