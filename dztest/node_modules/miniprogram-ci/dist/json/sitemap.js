"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSiteMapJSON=void 0;const path=require("path"),tools_1=require("../utils/tools"),projectconfig_1=require("./projectconfig"),locales=require("../utils/locales/locales"),config_1=require("../config"),common_1=require("../utils/common"),common_2=require("./common"),{schemaValidate:schemaValidate}=require("../validate/schemaValidate"),cache_1=require("../utils/cache"),reactiveCache_1=require("./reactiveCache");exports.getSiteMapJSON=reactiveCache_1.wrapCompileJSONFunc(cache_1.CACHE_KEY.SITE_MAP_JSON,(function(e){const r=projectconfig_1.getProjectConfigJSON(e),o=tools_1.normalizePath(path.posix.join(r.miniprogramRoot||"","sitemap.json"));if(!e.stat("",o))return e.type,config_1.COMPILE_TYPE.miniProgramPlugin,{desc:"",rules:[{action:"disallow",page:"*"}]};const t=e.getFile("",o),c=common_1.checkUTF8(t,o),i=common_2.checkJSONFormat(c,o),a=schemaValidate("sitemap",i);if(a.error.length){const e=a.error.map(e=>"type"===e.errorType||"enum"===e.errorType||"anyOf"===e.errorType?locales.config.JSON_CONTENT_SHOULD_BE.format([e.errorProperty,e.correctType]):locales.config.SHOULD_NOT_BE_EMPTY.format([e.requireProperty])).join("\n");common_1.throwError({msg:e,filePath:o})}return i}));