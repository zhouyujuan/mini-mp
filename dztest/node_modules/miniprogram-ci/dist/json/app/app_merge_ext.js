"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAppJSON=void 0;const path=require("path"),cache_1=require("../../utils/cache"),lodash_1=require("lodash"),app_1=require("./app"),ext_1=require("./ext"),_app_1=require("./_app"),projectconfig_1=require("../projectconfig"),common_1=require("../../utils/common"),locales=require("../../utils/locales/locales"),theme_1=require("../theme"),reactiveCache_1=require("../reactiveCache");exports.getAppJSON=reactiveCache_1.wrapCompileJSONFunc(cache_1.CACHE_KEY.COMPILED_APP_JSON,(function(e,t=!1){const o=projectconfig_1.getProjectConfigJSON(e),{miniprogramRoot:p=""}=o;let r=app_1.getAppJSON(e);const c=ext_1.getExtJSON(e);if(c&&(r=lodash_1.cloneDeep(r),_app_1.mergeExtJSON(r,c),c.extEnable))try{const t=theme_1.getThemeLocation(e);let o={};t&&(o=theme_1.checkThemeJSON(e,{themeLocation:t}));const c=theme_1.mergeThemeJSONToAppJSON(o,r);app_1.checkAppJSON({project:e,miniprogramRoot:p,inputJSON:c.appJSONLight,filePath:path.posix.join(p,"app.json")}),app_1.checkAppJSON({project:e,miniprogramRoot:p,inputJSON:c.appJSONDark,filePath:path.posix.join(p,"app.json")})}catch(e){common_1.throwError({msg:e.message,code:e.code,filePath:`app.json ${locales.config.OR} ext.json`})}return r}));