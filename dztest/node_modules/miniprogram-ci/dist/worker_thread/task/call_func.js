"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.call=void 0;const config_1=require("../config"),FUNC=require("./func");let workerThreads,supportWorkerThread=!1;try{workerThreads=require("worker_threads"),supportWorkerThread=!0}catch(r){supportWorkerThread=!1}const callMainThread=function(){if(!supportWorkerThread||workerThreads.isMainThread)return(r,e)=>{};let r=0;const e={};return workerThreads.parentPort.on("message",r=>{const{command:o,data:a}=r;if(o!==config_1.COMMAND.CALL_FUNC_RESULT)return;const{id:t,result:s,error:n}=a,c=e[t];return delete e[t],c?n?c.reject(n):void c.resolve(s):void 0}),(o,a)=>new Promise((t,s)=>{const n=r++;e[n]={resolve:t,reject:s},workerThreads.parentPort.postMessage({command:config_1.COMMAND.CALL_FUNC,data:{id:n,funcName:o,args:a}})})}();function call(r,...e){return!supportWorkerThread||workerThreads.isMainThread?FUNC[r].apply(null,e):callMainThread(r,e)}exports.call=call;