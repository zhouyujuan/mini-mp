"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compile=exports.compilePlugin=void 0;const path=require("path"),projectconfig_1=require("../json/projectconfig"),common_1=require("./common"),plugin_1=require("../json/plugin/plugin"),game_1=require("./game"),white_ext_list_1=require("../utils/white_ext_list");async function compilePlugin(i,e){const t=await projectconfig_1.getProjectConfigJSON(i),o=t.pluginRoot,{GameWhiteList:n}=await white_ext_list_1.getWhiteExtList(),c=i.getFileList(o,"").filter(common_1.isNotIgnoredByProjectConfig.bind(null,t,o)).filter(i=>n.has(path.posix.extname(i))),p=await plugin_1.getDevPluginJSON(i,!1),s=c.filter(i=>".js"===path.posix.extname(i)).map(i=>path.posix.relative(o,i)),a=await common_1.compileJSFiles(i,s,o,e),l=c.filter(i=>".js"!==path.posix.extname(i)&&i!==path.posix.join(o,"plugin.json")),r=await common_1.compileOther(i,l,e);return Object.assign(Object.assign({[path.posix.join(o,"plugin.json")]:JSON.stringify(p)},a),r)}async function compile(i,e){const t=await projectconfig_1.getProjectConfigJSON(i,!1),o=await compilePlugin(i,e),n=await game_1.compile(i,e),c=await common_1.getUploadProjectConfig(i,t);return c.__compileDebugInfo__=e.__compileDebugInfo__||{},Object.assign(Object.assign(Object.assign({},o),n),{"project.config.json":JSON.stringify(c)})}exports.compilePlugin=compilePlugin,exports.compile=compile;