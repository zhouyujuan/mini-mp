"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compileWXML=void 0;const path=require("path"),tools_1=require("../../utils/tools"),locales=require("../../utils/locales/locales"),config_1=require("../../config"),taskstatus_1=require("../../utils/taskstatus"),worker_thread_1=require("../../worker_thread"),common_1=require("../../utils/common");async function compileWXML(e,r,o){const{root:t="",setting:s={},onProgressUpdate:a=(()=>{})}=o,{minifyWXML:i}=s,c=new taskstatus_1.TaskStatus(r),n=path.posix.join(t,r),l=await e.getFile(t,r);if(!i){a(c);const e=tools_1.bufferToUtf8String(l);return void 0===e&&common_1.throwError({msg:locales.config.FILE_NOT_UTF8.format(n),code:config_1.FILE_NOT_UTF8,filePath:n}),c.done(),a(c),{filePath:r,code:e.replace(/\r\n/g,"\n")}}const _=await worker_thread_1.runTask(worker_thread_1.TASK_NAME.MINIFY_WXML,{projectPath:e.projectPath,root:t,filePath:r,setting:s,code:l},e=>{e===worker_thread_1.ETaskStatus.progress?a(c):e===worker_thread_1.ETaskStatus.done&&(c.done(),a(c))});return _.error&&common_1.throwError({msg:_.error.message,code:_.error.code.replace(/\r\n/g,"\n"),filePath:n}),{filePath:r,code:_.code.replace(/\r\n/g,"\n")}}exports.compileWXML=compileWXML;