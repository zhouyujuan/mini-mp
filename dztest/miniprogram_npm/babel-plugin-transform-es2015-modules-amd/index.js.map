{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nexports.__esModule = true;\n\nvar _create = require(\"babel-runtime/core-js/object/create\");\n\nvar _create2 = _interopRequireDefault(_create);\n\nexports.default = function (_ref) {\n  var t = _ref.types;\n\n  function isValidRequireCall(path) {\n    if (!path.isCallExpression()) return false;\n    if (!path.get(\"callee\").isIdentifier({ name: \"require\" })) return false;\n    if (path.scope.getBinding(\"require\")) return false;\n\n    var args = path.get(\"arguments\");\n    if (args.length !== 1) return false;\n\n    var arg = args[0];\n    if (!arg.isStringLiteral()) return false;\n\n    return true;\n  }\n\n  var amdVisitor = {\n    ReferencedIdentifier: function ReferencedIdentifier(_ref2) {\n      var node = _ref2.node,\n          scope = _ref2.scope;\n\n      if (node.name === \"exports\" && !scope.getBinding(\"exports\")) {\n        this.hasExports = true;\n      }\n\n      if (node.name === \"module\" && !scope.getBinding(\"module\")) {\n        this.hasModule = true;\n      }\n    },\n    CallExpression: function CallExpression(path) {\n      if (!isValidRequireCall(path)) return;\n      this.bareSources.push(path.node.arguments[0]);\n      path.remove();\n    },\n    VariableDeclarator: function VariableDeclarator(path) {\n      var id = path.get(\"id\");\n      if (!id.isIdentifier()) return;\n\n      var init = path.get(\"init\");\n      if (!isValidRequireCall(init)) return;\n\n      var source = init.node.arguments[0];\n      this.sourceNames[source.value] = true;\n      this.sources.push([id.node, source]);\n\n      path.remove();\n    }\n  };\n\n  return {\n    inherits: require(\"babel-plugin-transform-es2015-modules-commonjs\"),\n\n    pre: function pre() {\n      this.sources = [];\n      this.sourceNames = (0, _create2.default)(null);\n\n      this.bareSources = [];\n\n      this.hasExports = false;\n      this.hasModule = false;\n    },\n\n\n    visitor: {\n      Program: {\n        exit: function exit(path) {\n          var _this = this;\n\n          if (this.ran) return;\n          this.ran = true;\n\n          path.traverse(amdVisitor, this);\n\n          var params = this.sources.map(function (source) {\n            return source[0];\n          });\n          var sources = this.sources.map(function (source) {\n            return source[1];\n          });\n\n          sources = sources.concat(this.bareSources.filter(function (str) {\n            return !_this.sourceNames[str.value];\n          }));\n\n          var moduleName = this.getModuleName();\n          if (moduleName) moduleName = t.stringLiteral(moduleName);\n\n          if (this.hasExports) {\n            sources.unshift(t.stringLiteral(\"exports\"));\n            params.unshift(t.identifier(\"exports\"));\n          }\n\n          if (this.hasModule) {\n            sources.unshift(t.stringLiteral(\"module\"));\n            params.unshift(t.identifier(\"module\"));\n          }\n\n          var node = path.node;\n\n          var factory = buildFactory({\n            PARAMS: params,\n            BODY: node.body\n          });\n          factory.expression.body.directives = node.directives;\n          node.directives = [];\n\n          node.body = [buildDefine({\n            MODULE_NAME: moduleName,\n            SOURCES: sources,\n            FACTORY: factory\n          })];\n        }\n      }\n    }\n  };\n};\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildDefine = (0, _babelTemplate2.default)(\"\\n  define(MODULE_NAME, [SOURCES], FACTORY);\\n\");\n\nvar buildFactory = (0, _babelTemplate2.default)(\"\\n  (function (PARAMS) {\\n    BODY;\\n  })\\n\");\n\nmodule.exports = exports[\"default\"];"]}